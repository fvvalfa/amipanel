{% extends 'base.html' %}
{% load static %}
{% block scripts %}
<script>
    var append_increment = 0;
    var d = new Date();
    var year = d.getFullYear();
    var month_num = d.getMonth()
    var day = d.getDate();

    // var curd = new Date();
    // var curyear = curd.getFullYear();
    // var curmonth_num = curd.getMonth()
    // var curday = curd.getDate();
    var firstload = true;

    setInterval(function () {
        curd = new Date();
        curyear = curd.getFullYear();
        curmonth_num = curd.getMonth()
        curday = curd.getDate();
        

        if ((year != curyear || month_num != curmonth_num || day != curday) || firstload) {
            firstload = false
            d = new Date();
            year = d.getFullYear();
            month_num = d.getMonth()
            day = d.getDate();
            $.ajax({
                type: "GET",
                url: "{% url 'get_all_birthdays' %}", 
                data:{'year':curyear, 'month':curmonth_num+1, 'day':curday}
            })
                .done(function (response) {
                    $('#placeevents').html(response);
                });
                $.ajax({
                type: "GET",
                url: "{% url 'get_events_by_date' %}", 
                data:{'year':curyear, 'month':curmonth_num+1, 'day':curday}
            })
                .done(function (response) {
                    $('#placebirthdays').html(response);
                });
            $.ajax({
                type: "GET",
                url: "{% url 'get_calendar' %}"  // URL to your view that serves new info
                // data: {'append_increment': append_increment}
            })
                .done(function (response) {
                    $('#placecalendar').html(response);
                    append_increment += 10;
                });
        }
    }, 1000)
</script>
{% endblock scripts %}


{% block body %}

<body>
    <div class="container-flex">

        <div class="wrapper">
            <section class="fulscreen">
                <div class="fullscreen__body">

                    {% include '_header.html' %}
                    <div class="row g-0">
                        <div class="col-md-6 events">
                            <div id ="placeevents"></div> 
                        </div>
                        <div class="col-md-6 calendar">
                            <div id="placecalendar"></div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col-md-6">
                            <div id="placebirthdays"></div>
                        </div>
                    </div>
                </div>
                {% comment %}
                <!-- {% include 'inc/_footer.html' %} -->
                {% endcomment%}
        </div>
        </section>
    </div>
    </div>

    {% endblock body %}



    {% comment %}
    <form action="/" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary btn-block" name="nextmonth">Предыдущий
            месяц</button>
        <button type="submit" class="btn btn-primary btn-block" name="prevmonth">Следующий
            месяц</button>
    </form>
    {% endcomment %}